<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>積木アプリ - Build with Shapes</title>
    <style>
        body {
            margin: 0;
            display: flex;
            height: 100vh;
            background-color: #1a1a1a;
            font-family: sans-serif;
            overflow: hidden;
        }

        /* ツールバー */
        #toolbar {
            width: 120px;
            background-color: #333;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px 10px;
            gap: 30px;
            border-right: 2px solid #444;
            z-index: 10;
        }

        /* 積木のパーツ共通設定 */
        .shape-item {
            width: 50px;
            height: 50px;
            background-color: skyblue;
            cursor: grab;
            transition: transform 0.2s;
        }

        .shape-item:active { cursor: grabbing; }

        /* 各形状 */
        .square { width: 50px; height: 50px; }
        .rect { width: 80px; height: 40px; }
        .parallelogram { 
            width: 60px; height: 40px; 
            transform: skew(-20deg); 
        }

        /* キャンバス */
        #canvas {
            flex-grow: 1;
            position: relative;
            background-color: #000;
            overflow: hidden;
        }

        /* キャンバス上のパーツ */
        .placed-shape {
            position: absolute;
            background-color: skyblue;
            cursor: move;
            user-select: none;
        }

        /* リセットボタン */
        #reset-btn {
            margin-top: auto;
            padding: 10px 15px;
            background-color: #ff4444;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
        }

        #reset-btn:hover { background-color: #ff6666; }
    </style>
</head>
<body>

<div id="toolbar">
    <div class="shape-item square" draggable="true" data-shape="square"></div>
    <div class="shape-item rect" draggable="true" data-shape="rect"></div>
    <div class="shape-item parallelogram" draggable="true" data-shape="parallelogram"></div>
    
    <button id="reset-btn">りせっと</button>
</div>

<div id="canvas"></div>

<script>
    const canvas = document.getElementById('canvas');
    const resetBtn = document.getElementById('reset-btn');

    // ドラッグ開始時の処理
    document.addEventListener('dragstart', (e) => {
        if (e.target.classList.contains('shape-item')) {
            e.dataTransfer.setData('shapeType', e.target.dataset.shape);
            // マウス位置と要素の左上とのオフセットを計算（簡易的）
            e.dataTransfer.setData('offsetX', e.offsetX);
            e.dataTransfer.setData('offsetY', e.offsetY);
        }
    });

    // キャンバス上でのドロップを許可
    canvas.addEventListener('dragover', (e) => {
        e.preventDefault();
    });

    // ドロップした時の処理
    canvas.addEventListener('drop', (e) => {
        e.preventDefault();
        const shapeType = e.dataTransfer.getData('shapeType');
        const offsetX = e.dataTransfer.getData('offsetX');
        const offsetY = e.dataTransfer.getData('offsetY');

        if (shapeType) {
            createShape(shapeType, e.clientX - canvas.offsetLeft - offsetX, e.clientY - offsetY);
        }
    });

    // 新しい積木を作成する関数
    function createShape(type, x, y) {
        const shape = document.createElement('div');
        shape.classList.add('placed-shape');
        
        // 型に応じたクラス付与
        if (type === 'square') shape.classList.add('square');
        if (type === 'rect') shape.classList.add('rect');
        if (type === 'parallelogram') shape.classList.add('parallelogram');

        shape.style.left = `${x}px`;
        shape.style.top = `${y}px`;

        // キャンバス内での再移動（ドラッグ）
        makeDraggable(shape);

        canvas.appendChild(shape);
    }

    // キャンバス上の要素を動かせるようにする
    function makeDraggable(el) {
        let isDragging = false;
        let startX, startY;

        el.addEventListener('mousedown', (e) => {
            isDragging = true;
            startX = e.clientX - el.offsetLeft;
            startY = e.clientY - el.offsetTop;
            el.style.zIndex = 1000; // 最前面へ
        });

        document.addEventListener('mousemove', (e) => {
            if (!isDragging) return;
            el.style.left = `${e.clientX - startX}px`;
            el.style.top = `${e.clientY - startY}px`;
        });

        document.addEventListener('mouseup', () => {
            isDragging = false;
            el.style.zIndex = '';
        });
    }

    // リセット機能
    resetBtn.addEventListener('click', () => {
        if (confirm('すべてのパーツを消してもよろしいですか？')) {
            canvas.innerHTML = '';
        }
    });
</script>

</body>
</html>